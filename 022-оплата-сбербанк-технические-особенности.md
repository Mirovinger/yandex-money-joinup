<!--
https://gist.github.com/roachhd/1f029bd4b50b8a524f3c
https://yandex.ru/support/checkout/instructions/sberbank.html
`POST html-form param=value => eshop.xml` <sup>[...](#123)</sup> <br> <br>

Клиент по одному номеру заказа ZZZ выставил себе два счета в системе Сбербанк Онлайн и оба оплатил. При повторном выставлении счета по одному контракту, информация о предыдущем счете затирается системой и мы храним только последний выставленный счет. Соответственно по первому счету, который был неактуален (1 чек) платеж не прошел, а по второму счету (2 чек) операция успешно проведена в рамках транзакции 200134****8790.
По первому чеку денежные средства направлены на возврат в банк клиента. Сбербанк в среднем на своей стороне обрабатывает перевод в течение 1-3 рабочих дней. 
tt 20412257

-->

<img src="/i/sbol-logo-ru.jpg" width="200" />

Технические особенности 
=======================

> Вне зависимости от того, самописный у вас сайт или он сделан на основе "CMS + платежный модуль", технически любой платеж сбербан-онлайн формируется одинаково. На этой странице показаны все основные нюансы, которые стоит знать.

## Шаги оплаты

### Шаг 1. Страница оплаты на вашем сайте или вашем мобильном приложении

| Пример  | Описание                                 | 
| ------- | ---------------------------------------- |
| <img src="/i/merchant-site-with-pay-button-sample.png" /> | C вашего сайта, после нажатия кнопки "заплатить" в систему Яндекс.Касса передаются параметры платежного протокола и необходимые значения: <br><br> **Вариант "Сбербанк-Онлайн"** \| :eyeglasses:: [desk](#123), [mob](#123) <br> [base-html-form](#123) + платежный метод **`<input required name="paymentType" value="SB"/>`** + российский мобильный телефонный номер плательщика в сбербанк-онлайн `<input name="cps_phone" value="79001112233" />`<br> <br>**Вариант "Умный платёж"** \| :eyeglasses:: [desk](#123), [mob](#123) <br> [base-html-form](#123) + платежный метод **`<input required name="paymentType" value=""/>`**+ российский мобильный телефонный номер плательщика в сбербанк-онлайн `<input name="cps_phone" value="79001112233" />`<br> > в этом варианте пустое значение paymentType <br> <br>**Вариант "900"** \| :eyeglasses:: ~[desk](#123)~, [mob](#123) <br> [base-html-param](#123) + MWS метод createInvoice `smsPhoneNumber="79001112233"`<br><br> |

##### Примечание к шагу 1

* <sup>Для варианта "Сбербанк-Онлайн" и "Умный платеж", параметр `name="cps_phone"` и его значение могут не передаваться. Плательщик имеет возможность заполнить или изменить его сам на шаге 2.</sup>
* <sup>Если все переданные значения корректные, то вы переходите к Шагу-2. Если в значениях параметров есть ошибка или не передан обязательный параметр или метод "Сбербанк-онлайн" вам не подключен (или отключен), то вместо Шага-2 плательщик увидит [страницу с ошибкой](#technical-error).</sup>


### Шаг 2
| Шаг     | Описание                                 | 
| ------- | ---------------------------------------- |
| ![пример платежной страниц сбербанк-онлайн](/i/sberbank-online-sample-payment-page.png "пример платежной страниц сбербанк-онлайн") | `POST form param=value => eshop.xml` <br> <br> C вашего сайта, после нажатия кнопки "заплатить" в систему Яндекс.Касса передаются параметры платежного протокола и необходимые значения, при этом кроме основных данных платежной форме вы передаете: <br> `<input required name="paymentType" value="SB"/>` -- платежный метод Сбербанк-Онлайн <br> `<input required name="paymentType" value=""/>` или пустой  (тогда страница оплаты будет такой). <br><br> <sup> Если все переданные значения корректные, то вы переходите к Шагу-2. Если в значениях параметров есть ошибка или не передан обязательный параметр или метод "Сбербанк-онлайн" вам не подключен (или отключен), то вместо Шага-2 плательщик увидит [страницу с ошибкой](#technical-error).</sup> <br >Эту страницу вы увидите после шага-1, если вашему магазину доступен Сбербанк-онлайн в режиме смс и в режиме оплаты через личный кабинет Сбербанка.|

#### Шаг 2.1
| Шаг     | Описание                                 | 
| ------- | ---------------------------------------- |
| ![пример сообщения, которое вы видите, если магазину запрещена оплата сбербанк-онлайн через смс и доступен только метод оплаты через личный кабинет сбербанка](/i/sberbank-online-sample-prepay-page-to-redirect.png "пример сообщения, которое вы видите, если магазину запрещена оплата сбербанк-онлайн через смс и доступен только метод оплаты через личный кабинет сбербанка") | **Шаг 2.1** <br> 2. Если магазину запрещена оплата сбербанк-онлайн через смс и доступен только метод оплаты через личный кабинет сбербанка, после шага-1 плательщик увидит такую страницу |

### Шаг 3
| Шаг     | Описание                                 | 
| ------- | ---------------------------------------- |
| ![пример страницы авторизации в ЛК сбербанка](/i/sberbank-online-sample-sberLK-main-page.png "пример страницы авторизации в ЛК сбербанка") | 2.1 А затем будет автоматические редирект на страницу [личного кабинета Сбербанк-онлайн](https://online.sberbank.ru/)|


## Ошибки


| Пример  | Причины                                  | 
| ------- | ---------------------------------------- |
| <img src="/i/sberbank-online-sample-error-msg1.png" width="450" /> | <a name="technical-error"></a>**Не получилось. Техническая ошибка. Вариант 1** <br> * платежный метод вам не подключен (с момента начала регистрации метода для вашего магазина может пройти 1-2 недели, прежде, чем метод вам будет подключен; время требуется на все этапы регистрации); если метод работал, но вы получаете эту ошибку, возможно, вам отключили этот метод, уточните у вашего менеджера;|
|         | **Не получилось. Техническая ошибка. Вариант 2** <br> * в одном из параметров вы передаете неправильное или недопустимой значение; если не можете определить что, напишите нашим специалистам, они помогут.|
| <img src="/i/sberbank-online-sample-error-expire-contract-page.png" width="450" /> | **Что-то пошло не так** <br> Пример ошибки сбербанк-онлайн, в случае, когда плательщик открыл страницу из шага-2 и не выполнил оплату после в течении часа |
| ![В Сбербанке Онлайн нет такого аккаунта. Заплатите другим способом.](/i/sberbank-online-sample-error-user-phone-not-found.png "В Сбербанке Онлайн нет такого аккаунта. Заплатите другим способом.") | **Не получилось. В Сбербанке Онлайн нет такого аккаунта. Заплатите другим способом.** <br> Если на шаге-2 в поле для телефона был указан телефон, к номеру которого не привязан аккаунт в сбербанк-онлайн, то плательщик получит такое соообщение: `В Сбербанке Онлайн нет такого аккаунта. Заплатите другим способом.` |

### checkOrder
Если Ваш URL для обработки checkOrder уведомлений не ответил нашей системе коррректно или был не доступен (надо понимать, что уведомление checkOrder наша система доставляет только один раз), при этом на стороне Сбербанка этот платеж будет считаться успешным, плательщик в личном кабинете Сбербанка будет видеть чек успешной оплаты. Но, т.к. ваша система не ответила корректно на наш запрос checkOrder, заказ считается ошибочным. Далее мы инициируем отмену платежа в Сбербанке (процедура занимает в пределах трех рабочих дней).
