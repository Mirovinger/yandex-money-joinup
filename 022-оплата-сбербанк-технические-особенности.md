<img src="/i/sbol-logo-ru.jpg" width="200" />
технические особенности платежного метода
==========================================================

## Шаги оплаты Сбербанк-онлайн

### Шаг-1
Вне зависимости от того, самописный у вас сайт или он сделан на основе "CMS + платежный модуль", технически любой платеж формируется одинаково: `с вашего сайта, после нажатия кнопки "заплатить" в систему Яндекс.Касса передаются параметры платежного протокола и необходимые значения`:
```html
<!-- Пример минимальной формы для переди платежных данных с вашего сайта в нашу систему -->
    <form name="sample" action="https://money.yandex.ru/eshop.xml" method="post">
    <input required name="shopId" value="100500"/>
    <input required name="scid" value="100700"/>
    <input required name="sum" value="10.00" type="number" min="1"/>
    <input required name="customerNumber" value="testPay" size="64"/>
        
<!-- Платежный метод Сбербанк-Онлайн                                                    -->
    <input required name="paymentType" value="SB"/>
  
<!-- Поле name="cps_phone" необязательное, пользователь может заполнить его сам ===========
     Это номер российского мобильного телефона, к которому в Сбербанке у плательщика
     подключена услуга СбербанкОнлайн или привязан аккаунт                              -->
    <input name="cps_phone" value="79001112233" size="11"/>
        
    <input value="Заплатить" type="submit" /></form>
```

Если все переданные значения корректные, то вы переходите к Шагу-2. Если в значениях параметров есть ошибка или не передан обязательный параметр или метод "Сбербанк-онлайн" вам не подключен (или отключен), то вместо Шага-2 вы увидите страницу с ошибкой.


### Шаг-2

1. Эту страницу вы увидите после шага-1, если вашему магазину доступен Сбербанк-онлайн в режиме смс и в режиме оплаты через личный кабинет Сбербанка.
![пример платежной страниц сбербанк-онлайн](/i/sberbank-online-sample-payment-page.png "пример платежной страниц сбербанк-онлайн")

2. Если магазину запрещена оплата сбербанк-онлайн через смс и доступен только метод оплаты через личный кабинет сбербанка, после шага-1 плательщик увидит такую страницу
![пример сообщения, которое вы видите, если магазину запрещена оплата сбербанк-онлайн через смс и доступен только метод оплаты через личный кабинет сбербанка](/i/sberbank-online-sample-prepay-page-to-redirect.png "пример сообщения, которое вы видите, если магазину запрещена оплата сбербанк-онлайн через смс и доступен только метод оплаты через личный кабинет сбербанка")

2.1 А затем будет автоматические редирект на страницу [личного кабинета Сбербанк-онлайн](https://online.sberbank.ru/)  
![пример страницы авторизации в ЛК сбербанка](/i/sberbank-online-sample-sberLK-main-page.png "пример страницы авторизации в ЛК сбербанка")


### Шаг-3


## Ошибки при оплате

### Ошибка-1

![пример ошибки сбербанк-онлайн, в случае, если данный метод не подключен магазину](/i/sberbank-online-sample-error-msg1.png "пример ошибки сбербанк-онлайн, в случае, если данный метод не подключен магазину")

> Если после шага-1 вы видите такую ошибку, то скорее всего:
* платежный метод вам не подключен (с момента регистрации может пройти 1-2 недели, прежде, чем метод подключается; время требуется на все этапы регистрации); если метод работал, но вы получаете эту ошибку, возможно, вам отключили этот метод, уточните у вашего менеджера;
* в одном из параметров вы передаете неправильное или недопустимой значение; если не можете определить что, напишите нашим специалистам, они помогут.

### Ошибка "что-то пошло не так"
Пример ошибки сбербанк-онлайн, в случае, когда плательщик открыл страницу из шага-2 и не выполнил оплату после в течении часа  
![пример ошибки сбербанк-онлайн, в случае, когда плательщик открыл страницу из шага-2 и не выполнил оплату после в течении часа](/i/sberbank-online-sample-error-expire-contract-page.png "пример ошибки сбербанк-онлайн, в случае, когда плательщик открыл страницу из шага-2 и не выполнил оплату после в течении часа").

### Нет такого пользователя

Если на шаге-2 в поле для телефона был указан телефон, к номеру которого не привязан аккаунт в сбербанк-онлайн, то плательщик получит такое соообщение: `В Сбербанке Онлайн нет такого аккаунта. Заплатите другим способом.`  
![В Сбербанке Онлайн нет такого аккаунта. Заплатите другим способом.](/i/sberbank-online-sample-error-user-phone-not-found.png "В Сбербанке Онлайн нет такого аккаунта. Заплатите другим способом.")

### checkOrder
Если Ваш URL для обработки checkOrder уведомлений не ответил нашей системе коррректно или был не доступен (надо понимать, что уведомление checkOrder наша система доставляет только один раз), при этом на стороне Сбербанка этот платеж будет считаться успешным, плательщик в личном кабинете Сбербанка будет видеть чек успешной оплаты. Но, т.к. ваша система не ответила корректно на наш запрос checkOrder, заказ считается ошибочным. Далее мы инициируем отмену платежа в Сбербанке (процедура занимает в пределах трех рабочих дней).
